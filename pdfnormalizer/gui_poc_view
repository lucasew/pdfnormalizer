#!/usr/bin/env nix-shell
#! nix-shell -i python -p python3Packages.pdf2image python3Packages.pysimplegui python3Packages.opencv4 python3Packages.screeninfo
# vim:ft=python

from argparse import ArgumentParser
from pdf2image import convert_from_path
from pathlib import Path
import PySimpleGUI as sg
import numpy as np
import cv2
from screeninfo import get_monitors, Enumerator
from pdfnormalizer.utils import array_to_data, GUI, GUIHandler


class CustomGUIHandler(GUIHandler):
    pass


parser = ArgumentParser()
parser.add_argument('-i', type = Path, help = "PDF file to process", required = True)
parser.add_argument('-z', type = float, help = "zoom scale", default = 1)
parser.add_argument('-n', type = int, help = "start at page", default = 1)
args = parser.parse_args()

scale = args.z
page = args.n - 1

images = convert_from_path(args.i)
qt_images = len(images)

if page < 0 or page >= qt_images:
    raise Exception(f"Invalid page: {page + 1}")
handler = CustomGUIHandler(scale=scale, page=page)
gui = GUI(images, handler)
gui.run()
